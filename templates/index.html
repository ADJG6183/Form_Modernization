<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SHL Form Management System</title>
    <link rel="icon" href="{{ url_for('static', filename='images/white-logo.png') }}" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-theme.css') }}">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">        <div class="sidebar-icon" style="display: flex; align-items: center; justify-content: center; width: 100%; padding: 0 10px; margin-bottom: 1rem;">
            <img src="{{ url_for('static', filename='images/white-logo.png') }}" alt="Logo" style="max-width: 100%; height: auto; max-height: 60px; object-fit: contain;" />
        </div>
        
        <nav class="sidebar-nav">
            <a href="{{ url_for('home') }}" class="nav-item {% if request.endpoint == 'home' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                Dashboard
            </a>
            <a href="{{ url_for('saved_files') }}" class="nav-item {% if request.endpoint == 'saved_files' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
                Forms
            </a>
            <a href="{{ url_for('submissions') }}" class="nav-item {% if request.endpoint == 'submissions' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                </svg>
                Submissions
            </a>
            <a href="{{ url_for('analytics') }}" class="nav-item {% if request.endpoint == 'analytics' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                Analytics
            </a>
            <a href="{{ url_for('start_editing') }}" class="nav-item {% if request.endpoint == 'start_editing' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Create
            </a>
            <a href="{{ url_for('settings') }}" class="nav-item {% if request.endpoint == 'settings' %}active{% endif %}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
                Settings
            </a>
        </nav>
        
        <div style="margin-top: auto; padding: 1rem 0;">
            <button id="sidebar-logout-btn" class="nav-item" style="border: none; background: none; cursor: pointer; width: 100%;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Logout
            </button>
        </div>
    </aside>    <!-- Main Content -->
    <main class="main-container">
        <div class="header">
            <h1 class="page-title">Dashboard</h1>
            <div class="actions">
                <div class="search-container">
                    <input id="search-input" class="search-input" type="text" placeholder="Search forms..." autocomplete="off">
                    <div id="search-results" class="search-results" style="display:none;"></div>
                </div>
                <div class="avatar">{{ session['user_email'][0]|upper }}</div>
                <button id="top-logout-btn" class="button">Logout</button>
            </div>
        </div>
        
        <!-- Welcome Block -->
        <div class="content-card welcome-card">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="background: var(--primary-color); width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
                <div>
                    <h2 style="font-size: 1.5rem; font-weight: 500; margin: 0;">Welcome, {{ session['user_email'].split('@')[0]|title }}</h2>
                    <p style="color: var(--primary-light); margin: 0.5rem 0 0 0;">Here's what's happening with your forms today.</p>
                </div>
            </div>
        </div>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value">15</div>
                <div class="stat-label">total forms</div>
                <button class="button button-outline" style="margin-top:1rem;">View Forms</button>
            </div>
            <div class="stat-card">
                <div class="stat-value">5,650</div>
                <div class="stat-label">total submissions</div>
                <button class="button button-outline" style="margin-top:1rem;">View Submissions</button>
            </div>
        </div>
        
        <div class="content-card">
            <div class="header" style="margin-bottom:1rem;">
                <h2 style="font-size:1.25rem; font-weight:500;">Forms</h2>
                <a href="{{ url_for('saved_files') }}" class="button button-outline">View Forms</a>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Form Name</th>
                        <th>Submissions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if files %}                        {% for file in files[:5] %}
                        <tr>
                            <td>{{ file.name }}</td>
                            <td>{{ ((file.id * 123) % 2000) + 500 }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>                            <td colspan="2" style="text-align:center; padding:2rem; color:var(--secondary-color);">
                                No forms created yet. Create your first form using the Create button in the sidebar.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <div class="content-card">
            <div class="header" style="margin-bottom:1rem;">
                <h2 style="font-size:1.25rem; font-weight:500;">Recent Submissions</h2>
                <a href="{{ url_for('submissions') }}" class="button button-outline">View All</a>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% if files %}
                        {% for file in files[:5] %}
                        <tr>
                            <td>{{ ["John Doe", "Jane Smith", "Michael Brown", "Emily Clark", "Alex Wilson"] | random }}</td>
                            <td>{{ ["john@example.com", "jane@example.com", "michael@example.com", "emily@example.com", "alex@example.com"] | random }}</td>
                            <td>{{ file.upload_date }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>                            <td colspan="3" style="text-align:center; padding:2rem; color:var(--secondary-color);">
                                No submissions yet. Share your forms to start receiving submissions.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <div class="content-card">
            <div class="header" style="margin-bottom:1rem;">
                <h2 style="font-size:1.25rem; font-weight:500;">Upload New Form</h2>
            </div>
            <div id="drop-zone" style="border:2px dashed #ccc; border-radius:8px; background:rgba(255,255,255,0.95); padding:2rem; text-align:center;">
                <div style="margin-bottom:1.5rem;">
                    <svg style="display:block; margin:0 auto 1rem auto; height:48px; width:48px; color:var(--primary-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>                    <div style="color:var(--primary-color);">
                        <p style="font-weight:500;">Drag and drop your files here</p>
                        <p style="font-size:0.95em;">or</p>
                    </div>
                    <button id="browse-files" class="button">Browse Files</button>
                    <input type="file" id="fileinput" style="display:none;" accept=".docx,.pdf" multiple>
                </div>
            </div>
            <div id="upload-progress" style="margin-top:1.5rem; display:none;">
                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">                    <span style="font-size:0.95em; font-weight:500; color:var(--primary-color);" id="upload-status">Uploading...</span>
                    <span style="font-size:0.95em; font-weight:500; color:var(--primary-color);" id="upload-percentage">0%</span>
                </div>                <div style="width:100%; background:#b7c2bd; border-radius:8px; height:8px;">
                    <div id="progress-bar" style="background:var(--primary-color); height:8px; border-radius:8px; transition:width 0.3s; width:0%;"></div>
                </div>
            </div>
        </div>
    </main>    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/filemanager.js') }}"></script>      <script>
        // Global function to preview files when clicked in search results
        function previewFile(fileId, fileName) {
            window.location.href = `/designer?file_id=${fileId}`;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Logout button functionality with animation
            const topLogoutBtn = document.getElementById('top-logout-btn');
            if (topLogoutBtn) {
                topLogoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Create fade-out overlay
                    const overlay = document.createElement('div');
                    overlay.style.position = 'fixed';
                    overlay.style.top = '0';
                    overlay.style.left = '0';
                    overlay.style.width = '100%';
                    overlay.style.height = '100%';
                    overlay.style.backgroundColor = 'rgba(255, 255, 255, 0)';
                    overlay.style.transition = 'background-color 0.5s ease';
                    overlay.style.zIndex = '9999';
                    document.body.appendChild(overlay);
                    
                    // Fade out
                    setTimeout(() => {
                        overlay.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
                        setTimeout(() => {
                            window.location.href = "{{ url_for('logout') }}";
                        }, 400);
                    }, 50);
                });
            }
            
            // Search functionality
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            
            // Files data from server - parse safely
            let files = [];
            try {
                files = JSON.parse('{{ files|tojson|safe }}');
            } catch (e) {
                console.error("Error parsing files data:", e);
            }
            
            // Function to show search results
            function showSearchResults(query) {
                // Clear previous results
                searchResults.innerHTML = '';
                  // If query is empty, hide results
                if (!query) {
                    searchResults.classList.remove('visible');
                    setTimeout(() => {
                        searchResults.style.display = 'none';
                    }, 300); // Match the CSS transition duration
                    return;
                }
                      // Filter files based on query with error protection
                let filteredFiles = [];
                try {
                    if (Array.isArray(files)) {
                        filteredFiles = files.filter(file => 
                            file && file.name && file.name.toLowerCase().includes(query.toLowerCase())
                        );
                    }
                } catch (err) {
                    console.error('Error filtering files:', err);
                }
                
                // If no results, show message
                if (filteredFiles.length === 0) {
                    searchResults.innerHTML = '<div style="padding:1rem; text-align:center; color:var(--primary-light);">No files found matching your search</div>';
                    searchResults.style.display = 'block';
                    return;
                }
                
                // Create results list
                const resultsList = document.createElement('div');
                resultsList.className = 'search-results-list';
                
                // Add each file to results
                filteredFiles.forEach(file => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.style.padding = '0.75rem 1rem';
                    resultItem.style.borderBottom = '1px solid #eee';
                    resultItem.style.cursor = 'pointer';
                    resultItem.style.display = 'flex';
                    resultItem.style.justifyContent = 'space-between';
                    resultItem.style.alignItems = 'center';
                    
                    // Highlight matching text
                    const highlightedName = file.name.replace(
                        new RegExp(query, 'gi'),
                        match => `<span style="background:#54c1c6; color:#fefefe; font-weight:500;">${match}</span>`
                    );
                    
                    resultItem.innerHTML = `
                        <div>
                            <div style="font-weight:500;">${highlightedName}</div>                            <div style="font-size:0.8rem; color:var(--primary-light);">
                                ${file.upload_date} â€¢ ${file.file_type.toUpperCase()}
                            </div>
                        </div>
                        <div>
                            <button class="sp-btn" style="font-size:0.8rem; padding:0.25rem 0.5rem;">View</button>
                        </div>
                    `;
                      // Add click event with smooth transition
                    resultItem.addEventListener('click', () => {
                        // Add loading feedback
                        resultItem.style.backgroundColor = '#e6f0ff';
                        resultItem.style.transition = 'background-color 0.3s ease';
                        
                        // Hide search with delay to show the selection
                        setTimeout(() => {
                            searchResults.classList.remove('visible');
                            // Navigate to file preview
                            previewFile(file.id, file.name);
                        }, 400);
                    });
                    
                    resultsList.appendChild(resultItem);
                });
                  // Add results to container and show with animation
                searchResults.appendChild(resultsList);
                searchResults.style.display = 'block';
                
                // Trigger animation with a slight delay
                setTimeout(() => {
                    searchResults.classList.add('visible');
                }, 50);
            }
            
            // Add event listeners
            if (searchInput) {
                // Search as user types (debounced)
                let debounceTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(debounceTimeout);
                    debounceTimeout = setTimeout(() => {
                        showSearchResults(this.value.trim());
                    }, 300);
                });
                  // Close search results when clicking outside
                document.addEventListener('click', function(event) {
                    if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
                        searchResults.classList.remove('visible');
                        setTimeout(() => {
                            searchResults.style.display = 'none';
                        }, 300); // Match the CSS transition duration
                    }
                });
                
                // Show results when focused if input has value
                searchInput.addEventListener('focus', function() {
                    if (this.value.trim()) {
                        showSearchResults(this.value.trim());
                    }
                });
            }
        }); // End of DOMContentLoaded event listener    </script>
</body>
</html>
